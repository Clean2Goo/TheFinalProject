<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.member">
	<resultMap id="memResult" type="memberVO">
		<result property="id" column="USERID" />
        <result property="pwd" column="USERPWD" />
        <result property="name" column="USERNAME" />
        <result property="email" column="USEREMAIL" />
        <result property="phone" column="USERPHONE" />
        <result property="userType" column="USERTYPE" />
        <result property="joinDate" column="JOINDATE" />
        <result property="img" column="USERIMG" />
        <result property="rank" column="RANK" />
        <result property="dob" column="DOB" />
	</resultMap> 
	
    <!-- 회원 전체 목록 조회 -->
    <select id="selectAllMemberList" resultMap="memResult">
        <![CDATA[
            SELECT USERID, USERPWD, USERNAME, USEREMAIL, USERPHONE, USERTYPE, JOINDATE, USERIMG, RANK, DOB
            FROM USERS 
            ORDER BY JOINDATE DESC
        ]]>
    </select>
    
    <!-- 회원 가입 -->
    <insert id="insertMember" parameterType="memberVO">
        <![CDATA[
            INSERT INTO USERS (USERID, USERPWD, USERNAME, USEREMAIL, USERPHONE, USERTYPE, JOINDATE, USERIMG, RANK, DOB)
            VALUES (#{id}, #{pwd}, #{name}, #{email}, #{phone}, #{userType}, SYSDATE, , #{joinDate}, #{img}, #{rank}, #{dob})
        ]]>
    </insert>
    
    <!-- 회원 정보 수정 -->
    <update id="updateMember" parameterType="memberVO">
        <![CDATA[
            UPDATE USERS
            SET USERPWD = #{pwd}, 
                USERNAME = #{name}, 
                USEREMAIL = #{email}, 
                USERPHONE = #{phone},
                USERTYPE = #{userType},
                USERIMG = #{img}, 
                RANK = #{rank},
                DOB = #{dob}
            WHERE USERID = #{id}
        ]]>
    </update>
     
    <!-- 회원 삭제 -->
    <delete id="deleteMember" parameterType="String">
        <![CDATA[
            DELETE FROM USERS
            WHERE USERID = #{id}
        ]]>
    </delete>
    
    <!-- 로그인 체크 -->
    <select id="loginById" resultMap="memResult" parameterType="memberVO">
        <![CDATA[
            SELECT USERID, USERPWD, USERNAME, USEREMAIL, USERPHONE, USERTYPE, JOINDATE, USERIMG, RANK, DOB
            FROM USERS
            WHERE USERID = #{id} AND USERPWD = #{pwd}
        ]]>
    </select>
    
    <!-- member-mapper.xml -->
	<update id="updateProfileImage">
	    UPDATE Users
	    SET USERIMG = #{userImg}
	    WHERE USERID = #{id}
	</update>
	
	
	<!-- 사용자 정보 조회 (아이디로) -->
    <select id="getMemberById" resultType="MemberVO">
        SELECT * FROM USERS WHERE USERID = #{id}
    </select>

    <!-- 비밀번호 확인 (현재 비밀번호 확인) -->
    <select id="checkPassword" resultType="MemberVO">
        SELECT USERPWD FROM USERS WHERE USERID = #{id}
    </select>

    <!-- 비밀번호 업데이트 -->
    <update id="updatePassword">
        UPDATE USERS
        SET USERPWD = #{newPassword}
        WHERE USERID = #{id}
    </update>
    
</mapper>
